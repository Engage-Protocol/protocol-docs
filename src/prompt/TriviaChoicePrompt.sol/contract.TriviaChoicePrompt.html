<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>TriviaChoicePrompt - Engage Protocol</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Engage Protocol</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Engage-Protocol/engage-protocol" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="triviachoiceprompt"><a class="header" href="#triviachoiceprompt">TriviaChoicePrompt</a></h1>
<p><a href="https://github.com/Engage-Protocol/engage-protocol/blob/2890b2aea53065be300aa48413a18ae91f097053/src/prompt/TriviaChoicePrompt.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/src/prompt/IPromptStrategy.sol/interface.IPromptStrategy.html">IPromptStrategy</a>, ERC165</p>
<p>Contract for managing trivia questions with predefined correct answers</p>
<p><em>This contract implements the IPromptStrategy interface for handling multiple choice
trivia questions where there is a single correct answer. Players are rewarded based
on whether they select the correct answer or not.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="revealedquestions"><a class="header" href="#revealedquestions">revealedQuestions</a></h3>
<p>Mapping from question ID to the revealed question data</p>
<pre><code class="language-solidity">mapping(uint256 questionId =&gt; Prompt) public revealedQuestions;
</code></pre>
<h3 id="revealedat"><a class="header" href="#revealedat">revealedAt</a></h3>
<p>Mapping from question ID to the timestamp when it was revealed</p>
<pre><code class="language-solidity">mapping(uint256 questionId =&gt; uint256 timestamp) public revealedAt;
</code></pre>
<h3 id="solutionrevealedat"><a class="header" href="#solutionrevealedat">solutionRevealedAt</a></h3>
<p>Mapping from question ID to the timestamp when the solution was revealed</p>
<pre><code class="language-solidity">mapping(uint256 questionId =&gt; uint256 timestamp) public solutionRevealedAt;
</code></pre>
<h3 id="reactions"><a class="header" href="#reactions">reactions</a></h3>
<p>Mapping from question ID and player address to their reaction</p>
<pre><code class="language-solidity">mapping(uint256 questionId =&gt; mapping(address player =&gt; Reaction reaction)) public reactions;
</code></pre>
<h3 id="registry"><a class="header" href="#registry">registry</a></h3>
<pre><code class="language-solidity">Registry public immutable registry;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<pre><code class="language-solidity">constructor(address _registry);
</code></pre>
<h3 id="revealquestion"><a class="header" href="#revealquestion">revealQuestion</a></h3>
<p>Reveals a question to players</p>
<p><em>This function is called by the session manager to make a question available to players</em></p>
<pre><code class="language-solidity">function revealQuestion(bytes memory question, uint256 questionId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>question</code></td><td><code>bytes</code></td><td>The encoded question data</td></tr>
<tr><td><code>questionId</code></td><td><code>uint256</code></td><td>The unique identifier for the question</td></tr>
</tbody></table>
</div>
<h3 id="revealsolutions"><a class="header" href="#revealsolutions">revealSolutions</a></h3>
<p>Reveals the correct answers for multiple questions</p>
<p><em>This function allows the session manager to reveal the correct answers for
multiple questions at once. Each solution must match its commitment hash.</em></p>
<pre><code class="language-solidity">function revealSolutions(
    uint256 gameId,
    uint256[] memory questionIds,
    bytes[] calldata solutions,
    uint256[] calldata salts
) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>gameId</code></td><td><code>uint256</code></td><td>The ID of the game</td></tr>
<tr><td><code>questionIds</code></td><td><code>uint256[]</code></td><td>Array of question IDs to reveal solutions for</td></tr>
<tr><td><code>solutions</code></td><td><code>bytes[]</code></td><td>Array of encoded solution data</td></tr>
<tr><td><code>salts</code></td><td><code>uint256[]</code></td><td>Array of salts used in the commitments</td></tr>
</tbody></table>
</div>
<h3 id="_revealsolutions"><a class="header" href="#_revealsolutions">_revealSolutions</a></h3>
<p>Internal function to reveal the solution for a single question</p>
<p><em>This function verifies that the revealed solution matches the commitment hash
and stores the solution in the revealedQuestions mapping.</em></p>
<pre><code class="language-solidity">function _revealSolutions(uint256 _gameId, uint256 _questionId, bytes calldata _solution, uint256 salt) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gameId</code></td><td><code>uint256</code></td><td>The ID of the game</td></tr>
<tr><td><code>_questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
<tr><td><code>_solution</code></td><td><code>bytes</code></td><td>The encoded solution selection</td></tr>
<tr><td><code>salt</code></td><td><code>uint256</code></td><td>The salt used in the commitment</td></tr>
</tbody></table>
</div>
<h3 id="commitreaction"><a class="header" href="#commitreaction">commitReaction</a></h3>
<p>Allows a player to commit an answer to a question</p>
<p><em>Uses a commit-reveal scheme to prevent front-running. The actual answer is hidden
until the reveal phase begins.</em></p>
<pre><code class="language-solidity">function commitReaction(uint256 _gameId, uint256 _questionId, bytes32 _commit, address _user) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gameId</code></td><td><code>uint256</code></td><td>The ID of the game</td></tr>
<tr><td><code>_questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
<tr><td><code>_commit</code></td><td><code>bytes32</code></td><td>The commitment hash of the player's answer</td></tr>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the player</td></tr>
</tbody></table>
</div>
<h3 id="revealreaction"><a class="header" href="#revealreaction">revealReaction</a></h3>
<p>Allows a player to reveal their previously committed answer</p>
<p><em>The revealed answer must match the commitment hash provided during commit phase</em></p>
<pre><code class="language-solidity">function revealReaction(uint256 _gameId, uint256 _questionId, bytes calldata _selection, uint256 salt, address _user)
    external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gameId</code></td><td><code>uint256</code></td><td>The ID of the game</td></tr>
<tr><td><code>_questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
<tr><td><code>_selection</code></td><td><code>bytes</code></td><td>The encoded answer selection</td></tr>
<tr><td><code>salt</code></td><td><code>uint256</code></td><td>The salt used in the commitment</td></tr>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the player</td></tr>
</tbody></table>
</div>
<h3 id="isrevealed"><a class="header" href="#isrevealed">isRevealed</a></h3>
<p>Checks if a question has been revealed</p>
<pre><code class="language-solidity">function isRevealed(uint256 questionId) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the question has been revealed, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="getresult"><a class="header" href="#getresult">getResult</a></h3>
<p>Gets the result for a specific player on a specific question</p>
<p><em>The result is calculated based on whether the player's answer matches the correct solution.
Players who answer correctly get XP from the first tier, while incorrect answers get XP from the second tier.</em></p>
<pre><code class="language-solidity">function getResult(uint256 gameId, uint256 questionId, address user) external view returns (Result memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>gameId</code></td><td><code>uint256</code></td><td>The ID of the game</td></tr>
<tr><td><code>questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address of the player</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Result</code></td><td>The result containing XP earned and response time</td></tr>
</tbody></table>
</div>
<h3 id="getreactiontime"><a class="header" href="#getreactiontime">getReactionTime</a></h3>
<p>Gets the reaction time for a player on a specific question</p>
<pre><code class="language-solidity">function getReactionTime(uint256 questionId, address player) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>questionId</code></td><td><code>uint256</code></td><td>The ID of the question</td></tr>
<tr><td><code>player</code></td><td><code>address</code></td><td>The address of the player</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The time in seconds between question reveal and player's reaction</td></tr>
</tbody></table>
</div>
<h3 id="_getreactiontime"><a class="header" href="#_getreactiontime">_getReactionTime</a></h3>
<pre><code class="language-solidity">function _getReactionTime(uint256 questionId, address player) internal view returns (uint256);
</code></pre>
<h3 id="noop"><a class="header" href="#noop">noop</a></h3>
<pre><code class="language-solidity">function noop(Prompt calldata p) external pure;
</code></pre>
<h3 id="supportsinterface"><a class="header" href="#supportsinterface">supportsInterface</a></h3>
<pre><code class="language-solidity">function supportsInterface(bytes4 interfaceId) public view virtual override(IERC165, ERC165) returns (bool);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="answerrevealed"><a class="header" href="#answerrevealed">AnswerRevealed</a></h3>
<pre><code class="language-solidity">event AnswerRevealed(uint256 indexed gameId, uint256 indexed questionId, address indexed player, uint16 selection);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="revealmismatch"><a class="header" href="#revealmismatch">RevealMismatch</a></h3>
<pre><code class="language-solidity">error RevealMismatch(uint256 gameId, uint256 questionId, uint16 selection, uint256 salt, bytes32 commitment);
</code></pre>
<h3 id="solutionalreadyrevealed"><a class="header" href="#solutionalreadyrevealed">SolutionAlreadyRevealed</a></h3>
<pre><code class="language-solidity">error SolutionAlreadyRevealed(uint256 questionId);
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="prompt"><a class="header" href="#prompt">Prompt</a></h3>
<p>Structure containing all the data for a revealed question</p>
<p><em>This struct holds all the information needed to display and process a trivia question</em></p>
<pre><code class="language-solidity">struct Prompt {
    address sessionManager;
    uint256 gameId;
    string questionText;
    uint256 reactionDeadline;
    bytes32 solutionCommitment;
    uint16 solution;
    string[] media;
    string[] choices;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sessionManager</code></td><td><code>address</code></td><td>Address of the session manager where the question belongs to</td></tr>
<tr><td><code>gameId</code></td><td><code>uint256</code></td><td>ID of the game this question belongs to</td></tr>
<tr><td><code>questionText</code></td><td><code>string</code></td><td>Text of the question</td></tr>
<tr><td><code>reactionDeadline</code></td><td><code>uint256</code></td><td>Deadline for players to commit their answers</td></tr>
<tr><td><code>solutionCommitment</code></td><td><code>bytes32</code></td><td>Commitment hash of the correct answer</td></tr>
<tr><td><code>solution</code></td><td><code>uint16</code></td><td>The correct answer choice (0-indexed)</td></tr>
<tr><td><code>media</code></td><td><code>string[]</code></td><td></td></tr>
<tr><td><code>choices</code></td><td><code>string[]</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="reaction"><a class="header" href="#reaction">Reaction</a></h3>
<p>Structure for storing a player's reaction to a question</p>
<p><em>Extends BaseReaction with the specific answer choice selected</em></p>
<pre><code class="language-solidity">struct Reaction {
    BaseReaction baseReaction;
    uint16 answer;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>baseReaction</code></td><td><code>BaseReaction</code></td><td>Base reaction data (commit, timestamp, etc.)</td></tr>
<tr><td><code>answer</code></td><td><code>uint16</code></td><td>The answer choice selected by the player (0-indexed)</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/prompt/SPBinaryPrompt.sol/contract.SPBinaryPrompt.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/reward/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/prompt/SPBinaryPrompt.sol/contract.SPBinaryPrompt.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/reward/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
